<html>
<head>
  <title>Web Share Test</title>
  <meta name="viewport" content="width=device-width">
</head>
<body>
  <h1>Web Share Test</h1>
  <table>
    <tr>
		<td>URL:</td>
        <td><input id="url" value="https://example.com" size="40"/></td>
    </tr>
    
  </table>
  <p>
	<input id="share" type="button" value="Share" />
  </p>
  
  <script>
    'use strict';

    function sleep(delay) {
      return new Promise(resolve => {
        setTimeout(resolve, delay);
      });
    }

    function logText(message, isError) {
      if (isError)
        console.error(message);
      else
        console.log(message);
    }

    function logError(message) {
      logText(message, true);
    }

    async function testWebShare() {
      if (navigator.share === undefined) {
        logError('Error: Unsupported feature: navigator.share()');
        return;
      }

      const url_input = document.querySelector('#url');
      
      const url = url_input.value;
      

      try {
        await navigator.share({url});
        logText('Successfully sent share');
      } catch (error) {
        logError('Error sharing: ' + error);
      }
    }

    function onLoad() {
      document.querySelector('#share').addEventListener('click', testWebShare);
      
      if (navigator.share === undefined) {
        if (window.location.protocol === 'http:') {
          // navigator.share() is only available in secure contexts.
          window.location.replace(window.location.href.replace(/^http:/, 'https:'));
        } else {
          logError('Error: You need to use a browser that supports this draft ' +
                   'proposal.');
        }
      }
    }

    window.addEventListener('load', onLoad);
  </script>
</body>
</html>
